{% extends 'spotify/main.html' %}
{% block head %}
{{ super() }}
<link rel="stylesheet" href="{{ url_for('static', filename='css/spotify/tracks.css') }}" />
{% endblock %}

{% block body %} 
{{ super() }}
<div class="table-box bg-dark">
    <div class="header d-flex flex-wrap">
        <div class="p-2">
            <h3 class="table-name">{{caption}}</h3>
            <div class="time-select-buttons">
                <a href="{{ request.path }}?time_range=short_term" class="link-secondary">Four Weeks</a>
                <a href="{{ request.path }}?time_range=medium_term" class="link-secondary">Six Months</a>
                <a href="{{ request.path }}?time_range=long_term" class="link-secondary">All Time</a>
            </div>
        </div>
        <div class="ms-auto p-2 d-flex align-items-end select-box">
            <select class="form-select form-select-sm table-sort">
                <option selected value="affinity">Sort by track affinity</option>
                <option value="name">Sort by track name</option>
                <option value="artist">Sort by artists</option>
                <option value="album">Sort by album</option>
                <option value="duration">Sort by track length (short to long)</option>
                <option value="popularity">Sort by track popularity (least to most)</option>
                <option value="tempo">Sort by track tempo (slowest to fastest)</option>
                <option value="danceability">Sort by danceability (least to most)</option>
                <option value="valence">Sort by mood (sad to happy)</option>
                <option value="energy">Sort by energy (least to most)</option>
            </select>
        </div>
    </div>
    <table class="table align-middle">
        <thead>
            <tr>
                <th scope="col">#</th>
                <th scope="col">Cover</th>
                <th scope="col">Track</th>
                <th scope="col">Artist</th>
                <th class="unseen" scope="col">Duration</th>
            </tr>
        </thead>
        <tbody>
            {% for track in data %}
                <tr class="rows" data-track="{{track.json}}">
                    <th scope="row">{{track.index}}</th>
                    <td>
                        <div class="container">
                            <img class="cover" src="{{track.image}}">
                            <div class="overlay">
                                <span class="icon play-pause">
                                    <i class="fa fa-play"></i>
                                    <audio class="audio" src="{{track.preview}}"></audio>
                                </span>
                            </div>
                        </div>
                    </td>
                    <td>
                        <a class="link-light" href="{{url_for('spotify_track', track_id=track.id)}}">{{track.name}}</a>
                    </td>
                    <td>
                        {% for artist in track.artists %}
                        <a class="link-light" href="{{url_for('spotify_artist', artist_id=artist['id'])}}">{{artist["name"]}}</a>
                        {% endfor %}
                    </td>
                    <td class="unseen">{{track.duration}}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        <div class="d-flex align-items-center justify-content-center">
            {% if track %}
            <a href="{{ url_for('create_playlist', spotify_type='top')}}?time_range={{request.args.get('time_range', 'short_term')}}" class="btn btn-primary playlist-button" role="button" aria-pressed="true">Create Playlist</a>
            {% elif recent %}
            <a href="{{ url_for('create_playlist', spotify_type='recent')}}" class="btn btn-primary playlist-button" role="button" aria-pressed="true">Create Playlist</a>
            {% elif liked %}
            <a href="{{ url_for('create_playlist', spotify_type='liked')}}" class="btn btn-primary playlist-button" role="button" aria-pressed="true">Create Playlist</a>
            {% endif %}
        </div>
        <script src="{{ url_for('static', filename='js/spotify.js')}}" type="text/javascript"></script>
        {% endblock %}
    </div>
        
        