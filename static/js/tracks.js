// Javascript for ./templates/spotify/tracks.html

$(function () {
    // Generates a playlist based on data- attrs on playlist button
    $(".playlist-button").on("click", function () {
        $(this).prop("disabled", true); // disable the button so people don't spam click
        $(this).html('<i class="fa fa-circle-o-notch fa-spin"></i> Creating playlist...'); // update button to spin
        var type = $(this).data("type");
        var track_ids = $(this).data("track_ids");
        var date = new Date().toLocaleDateString("en-US", {
            year: "numeric",
            month: "long",
            day: "numeric",
        });
        if (type === "top") {
            var timeRange = $(".time-select-buttons .link-light").text().toLowerCase(); // active time select means time range.
            var playlistName = "Top Tracks " + date;
            var playlistDesc = "Top tracks in the past " + timeRange + " (Generated by Sketyl.com)";
        }
        if (type === "recent") {
            var playlistName = "Recent Tracks " + date;
            var playlistDesc = "Top 50 most recent listens (Generated by Sketyl.com)";
        }
        if (type === "liked") {
            var playlistName = "Liked Tracks " + date;
            var playlistDesc = "Current Liked Tracks (Generated by Sketyl.com)";
        }
        createPlaylist(playlistName, playlistDesc, track_ids); // Function in ./utils.js
        $(this).children("i").remove(); // Remove spinner icon
        $(this).text("Playlist Created") // success message
    });
});

$(function () {
    // this will get the full URL at the address bar
    // passes on every "a" tag
    $(".dropdown-item").each(function () {
        // checks if its the same on the address bar
        if (
            window.location.href == this.href ||
            window.location.href == this.href + "?time_range=short_term"
        ) {
            $(this).remove();
        }
    });
});

$(function () {
    // this will get the full URL at the address bar

    $(".time-select-buttons")
        .children()
        .each(function () {
            // checks if its the same on the address bar
            if (
                window.location.href == this.href ||
                window.location.href + "?time_range=short_term" == this.href
            ) {
                $(this).addClass("link-light").removeClass("link-secondary");
            }
        });
});
